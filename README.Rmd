---
output:
  github_document
---

`emoncmsr` : Tools to work with the emonCMS API.

- emonCMS: https://openenergymonitor.org/

## Installation
```{r eval=FALSE}
devtools::install_github("davidski/emoncmsr")
```

## Usage

* Set environment variables
    * EMONCMS_URI - Full URL (w/final slash) to API endpoint
    * EMONCMS_API_KEY - API key value (read or write) to API
* Inputs
    * Post to inputs
    * List inputs
    * Delete inputs
* Feeds
    * List feeds
    * Get range of data from a feed
    * Get storage info for all feeds

```{r}
library(emoncmsr)
library(tidyverse)

# Inputs
list_inputs()
# create some beverage data
dat <- list(coffee = 42, tea = 6, water = 42)
post_data_to_input(dat)
list_inputs() %>% filter(name == "coffee")
# store the id of the new input
inputid <- list_inputs() %>% filter(name == "coffee") %>% pull(id)
inputid

# Create feeds for one of our new inputs
feed_response <- create_feed("coffeelevel", "testnode")
feed_response
list_feeds() %>% filter(id == feed_response$feedid)

# Hook up the coffee monitor to the feed
set_input_process(inputid, paste(1, feed_response$feedid, sep=":"))
get_input_processes(inputid)

# Post new data to our inputs
dat <- list(coffee = 86, tea = 100, water = 4)
post_data_to_input(dat)

# Verify that the new value is posted
get_feed_values(feed_response$feedid)
```

## Test results

```{r}
library(emoncmsr)
library(testthat)

date()

test_dir("tests/")
```

# Contributing

This project is governed by a [Code of Conduct](./CODE_OF_CONDUCT.md). By 
participating in this project you agree to abide by these terms.

# License

The [MIT License](LICENSE) applies.
